<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationFeedbackScreen.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.serenityai.ui.screens</a> &gt; <span class="el_source">ApplicationFeedbackScreen.kt</span></div><h1>ApplicationFeedbackScreen.kt</h1><pre class="source lang-java linenums">package com.serenityai.ui.screens

import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.serenityai.usecases.ApplicationFeedbackUseCase
import com.serenityai.usecases.UserSupportUseCase
import com.serenityai.usecases.FeedbackType
import com.serenityai.usecases.FeedbackStatus
import com.serenityai.usecases.FeedbackSubmission
import java.text.SimpleDateFormat
import java.util.*

@OptIn(ExperimentalMaterial3Api::class)
@Composable
<span class="nc bnc" id="L28" title="All 10 branches missed.">fun ApplicationFeedbackScreen(onNavigateBack: () -&gt; Unit) {</span>
<span class="nc" id="L29">    val useCase = remember { ApplicationFeedbackUseCase() }</span>
<span class="nc" id="L30">    val userId = &quot;user123&quot; // In production, get from auth</span>
    
<span class="nc" id="L32">    var selectedTab by remember { mutableStateOf(0) }</span>
<span class="nc" id="L33">    var feedbackType by remember { mutableStateOf&lt;FeedbackType?&gt;(null) }</span>
<span class="nc" id="L34">    var message by remember { mutableStateOf(&quot;&quot;) }</span>
<span class="nc" id="L35">    var rating by remember { mutableStateOf&lt;Int?&gt;(null) }</span>
<span class="nc" id="L36">    var category by remember { mutableStateOf(&quot;&quot;) }</span>
<span class="nc" id="L37">    var showSuccessDialog by remember { mutableStateOf(false) }</span>
<span class="nc" id="L38">    var userFeedback by remember { mutableStateOf&lt;List&lt;FeedbackSubmission&gt;&gt;(emptyList()) }</span>
    
    // Load user feedback
<span class="nc bnc" id="L41" title="All 2 branches missed.">    LaunchedEffect(Unit) {</span>
<span class="nc" id="L42">        userFeedback = useCase.getUserFeedback(userId)</span>
<span class="nc" id="L43">    }</span>
    
<span class="nc" id="L45">    Scaffold(</span>
<span class="nc" id="L46">        topBar = {</span>
<span class="nc bnc" id="L47" title="All 8 branches missed.">            TopAppBar(</span>
<span class="nc bnc" id="L48" title="All 8 branches missed.">                title = { Text(&quot;Application Feedback&quot;) },</span>
<span class="nc" id="L49">                navigationIcon = {</span>
<span class="nc bnc" id="L50" title="All 8 branches missed.">                    IconButton(onClick = onNavigateBack) {</span>
<span class="nc bnc" id="L51" title="All 8 branches missed.">                        Icon(Icons.Default.ArrowBack, contentDescription = &quot;Back&quot;)</span>
<span class="nc" id="L52">                    }</span>
<span class="nc" id="L53">                },</span>
<span class="nc" id="L54">                colors = TopAppBarDefaults.topAppBarColors(</span>
<span class="nc" id="L55">                    containerColor = MaterialTheme.colorScheme.primaryContainer</span>
                )
<span class="nc" id="L57">            )</span>
<span class="nc" id="L58">        }</span>
<span class="nc" id="L59">    ) { paddingValues -&gt;</span>
<span class="nc bnc" id="L60" title="All 6 branches missed.">        Column(</span>
<span class="nc" id="L61">            modifier = Modifier</span>
<span class="nc" id="L62">                .fillMaxSize()</span>
<span class="nc" id="L63">                .padding(paddingValues)</span>
        ) {
            // Tabs
<span class="nc" id="L66">            TabRow(selectedTabIndex = selectedTab) {</span>
<span class="nc bnc" id="L67" title="All 6 branches missed.">                Tab(</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">                    selected = selectedTab == 0,</span>
<span class="nc" id="L69">                    onClick = { selectedTab = 0 },</span>
<span class="nc bnc" id="L70" title="All 8 branches missed.">                    text = { Text(&quot;Submit Feedback&quot;) }</span>
                )
<span class="nc bnc" id="L72" title="All 2 branches missed.">                Tab(</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">                    selected = selectedTab == 1,</span>
<span class="nc" id="L74">                    onClick = { selectedTab = 1 },</span>
<span class="nc bnc" id="L75" title="All 8 branches missed.">                    text = { Text(&quot;My Feedback&quot;) }</span>
<span class="nc" id="L76">                )</span>
<span class="nc" id="L77">            }</span>
            
<span class="nc bnc" id="L79" title="All 3 branches missed.">            when (selectedTab) {</span>
<span class="nc" id="L80">                0 -&gt; SubmitFeedbackTab(</span>
<span class="nc" id="L81">                    feedbackType = feedbackType,</span>
<span class="nc" id="L82">                    onFeedbackTypeChange = { feedbackType = it },</span>
<span class="nc" id="L83">                    message = message,</span>
<span class="nc" id="L84">                    onMessageChange = { message = it },</span>
<span class="nc" id="L85">                    rating = rating,</span>
<span class="nc" id="L86">                    onRatingChange = { rating = it },</span>
<span class="nc" id="L87">                    category = category,</span>
<span class="nc" id="L88">                    onCategoryChange = { category = it },</span>
<span class="nc" id="L89">                    onSubmit = {</span>
<span class="nc" id="L90">                        try {</span>
<span class="nc" id="L91">                            useCase.submitFeedback(</span>
<span class="nc" id="L92">                                userId = userId,</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                                feedbackType = feedbackType ?: FeedbackType.GENERAL,</span>
<span class="nc" id="L94">                                message = message,</span>
<span class="nc" id="L95">                                rating = rating,</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">                                category = category.ifBlank { null }</span>
                            )
<span class="nc" id="L98">                            showSuccessDialog = true</span>
<span class="nc" id="L99">                            message = &quot;&quot;</span>
<span class="nc" id="L100">                            rating = null</span>
<span class="nc" id="L101">                            category = &quot;&quot;</span>
<span class="nc" id="L102">                            feedbackType = null</span>
<span class="nc" id="L103">                            userFeedback = useCase.getUserFeedback(userId)</span>
<span class="nc" id="L104">                        } catch (e: Exception) {</span>
                            // Handle error
                        }
<span class="nc" id="L107">                    }</span>
                )
<span class="nc" id="L109">                1 -&gt; MyFeedbackTab(feedback = userFeedback)</span>
<span class="nc" id="L110">            }</span>
<span class="nc" id="L111">        }</span>
<span class="nc" id="L112">    }</span>
    
    // Success Dialog
<span class="nc bnc" id="L115" title="All 2 branches missed.">    if (showSuccessDialog) {</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">        AlertDialog(</span>
<span class="nc" id="L117">            onDismissRequest = { showSuccessDialog = false },</span>
<span class="nc bnc" id="L118" title="All 8 branches missed.">            title = { Text(&quot;Feedback Submitted&quot;) },</span>
<span class="nc bnc" id="L119" title="All 8 branches missed.">            text = { Text(&quot;Thank you for your feedback! We'll review it and get back to you if needed.&quot;) },</span>
<span class="nc" id="L120">            confirmButton = {</span>
<span class="nc bnc" id="L121" title="All 8 branches missed.">                TextButton(onClick = { showSuccessDialog = false }) {</span>
<span class="nc bnc" id="L122" title="All 8 branches missed.">                    Text(&quot;OK&quot;)</span>
<span class="nc" id="L123">                }</span>
<span class="nc" id="L124">            }</span>
        )
    }
<span class="nc bnc" id="L127" title="All 2 branches missed.">}</span>

@Composable
fun SubmitFeedbackTab(
    feedbackType: FeedbackType?,
    onFeedbackTypeChange: (FeedbackType?) -&gt; Unit,
    message: String,
    onMessageChange: (String) -&gt; Unit,
    rating: Int?,
    onRatingChange: (Int?) -&gt; Unit,
    category: String,
    onCategoryChange: (String) -&gt; Unit,
    onSubmit: () -&gt; Unit
<span class="nc bnc" id="L140" title="All 42 branches missed.">) {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">    LazyColumn(</span>
<span class="nc" id="L142">        modifier = Modifier.fillMaxSize(),</span>
<span class="nc" id="L143">        contentPadding = PaddingValues(16.dp),</span>
<span class="nc bnc" id="L144" title="All 18 branches missed.">        verticalArrangement = Arrangement.spacedBy(16.dp)</span>
<span class="nc" id="L145">    ) {</span>
<span class="nc" id="L146">        item {</span>
<span class="nc bnc" id="L147" title="All 8 branches missed.">            Text(</span>
<span class="nc" id="L148">                text = &quot;Help us improve!&quot;,</span>
<span class="nc" id="L149">                fontSize = 20.sp,</span>
<span class="nc" id="L150">                fontWeight = FontWeight.Bold</span>
<span class="nc" id="L151">            )</span>
<span class="nc" id="L152">        }</span>
        
<span class="nc" id="L154">        item {</span>
<span class="nc bnc" id="L155" title="All 6 branches missed.">            Text(</span>
<span class="nc" id="L156">                text = &quot;Feedback Type&quot;,</span>
<span class="nc" id="L157">                fontSize = 16.sp,</span>
<span class="nc" id="L158">                fontWeight = FontWeight.Medium</span>
            )
<span class="nc" id="L160">            Spacer(modifier = Modifier.height(8.dp))</span>
<span class="nc" id="L161">            Row(</span>
<span class="nc" id="L162">                modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L163">                horizontalArrangement = Arrangement.spacedBy(8.dp)</span>
            ) {
<span class="nc" id="L165">                FeedbackType.values().forEach { type -&gt;</span>
<span class="nc" id="L166">                    FilterChip(</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                        selected = feedbackType == type,</span>
<span class="nc" id="L168">                        onClick = { onFeedbackTypeChange(type) },</span>
<span class="nc bnc" id="L169" title="All 8 branches missed.">                        label = { Text(type.name.replace(&quot;_&quot;, &quot; &quot;)) },</span>
<span class="nc" id="L170">                        modifier = Modifier.weight(1f)</span>
                    )
<span class="nc" id="L172">                }</span>
<span class="nc" id="L173">            }</span>
<span class="nc" id="L174">        }</span>
        
<span class="nc" id="L176">        item {</span>
<span class="nc bnc" id="L177" title="All 8 branches missed.">            OutlinedTextField(</span>
<span class="nc" id="L178">                value = message,</span>
<span class="nc" id="L179">                onValueChange = onMessageChange,</span>
<span class="nc bnc" id="L180" title="All 8 branches missed.">                label = { Text(&quot;Your Feedback&quot;) },</span>
<span class="nc bnc" id="L181" title="All 8 branches missed.">                placeholder = { Text(&quot;Tell us what you think...&quot;) },</span>
<span class="nc" id="L182">                modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L183">                minLines = 4,</span>
<span class="nc" id="L184">                maxLines = 8</span>
<span class="nc" id="L185">            )</span>
<span class="nc" id="L186">        }</span>
        
<span class="nc" id="L188">        item {</span>
<span class="nc bnc" id="L189" title="All 8 branches missed.">            OutlinedTextField(</span>
<span class="nc" id="L190">                value = category,</span>
<span class="nc" id="L191">                onValueChange = onCategoryChange,</span>
<span class="nc bnc" id="L192" title="All 8 branches missed.">                label = { Text(&quot;Category (Optional)&quot;) },</span>
<span class="nc bnc" id="L193" title="All 8 branches missed.">                placeholder = { Text(&quot;e.g., UI, Performance, Feature&quot;) },</span>
<span class="nc" id="L194">                modifier = Modifier.fillMaxWidth()</span>
<span class="nc" id="L195">            )</span>
<span class="nc" id="L196">        }</span>
        
<span class="nc" id="L198">        item {</span>
<span class="nc bnc" id="L199" title="All 6 branches missed.">            Text(</span>
<span class="nc" id="L200">                text = &quot;Rating (Optional)&quot;,</span>
<span class="nc" id="L201">                fontSize = 16.sp,</span>
<span class="nc" id="L202">                fontWeight = FontWeight.Medium</span>
            )
<span class="nc" id="L204">            Spacer(modifier = Modifier.height(8.dp))</span>
<span class="nc" id="L205">            Row(</span>
<span class="nc" id="L206">                modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L207">                horizontalArrangement = Arrangement.spacedBy(8.dp)</span>
            ) {
<span class="nc" id="L209">                (1..5).forEach { value -&gt;</span>
<span class="nc" id="L210">                    FilterChip(</span>
<span class="nc bnc" id="L211" title="All 4 branches missed.">                        selected = rating == value,</span>
<span class="nc bnc" id="L212" title="All 4 branches missed.">                        onClick = { onRatingChange(if (rating == value) null else value) },</span>
<span class="nc bnc" id="L213" title="All 8 branches missed.">                        label = { Text(&quot;$value&quot;) },</span>
<span class="nc" id="L214">                        modifier = Modifier.weight(1f)</span>
                    )
<span class="nc" id="L216">                }</span>
<span class="nc" id="L217">            }</span>
<span class="nc" id="L218">        }</span>
        
<span class="nc" id="L220">        item {</span>
<span class="nc bnc" id="L221" title="All 8 branches missed.">            Button(</span>
<span class="nc" id="L222">                onClick = onSubmit,</span>
<span class="nc" id="L223">                modifier = Modifier.fillMaxWidth(),</span>
<span class="nc bnc" id="L224" title="All 6 branches missed.">                enabled = message.isNotBlank() &amp;&amp; feedbackType != null</span>
<span class="nc" id="L225">            ) {</span>
<span class="nc bnc" id="L226" title="All 8 branches missed.">                Text(&quot;Submit Feedback&quot;)</span>
<span class="nc" id="L227">            }</span>
<span class="nc" id="L228">        }</span>
<span class="nc" id="L229">    }</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">}</span>

@Composable
<span class="nc bnc" id="L233" title="All 10 branches missed.">fun MyFeedbackTab(feedback: List&lt;FeedbackSubmission&gt;) {</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">    if (feedback.isEmpty()) {</span>
<span class="nc" id="L235">        Column(</span>
<span class="nc" id="L236">            modifier = Modifier</span>
<span class="nc" id="L237">                .fillMaxSize()</span>
<span class="nc" id="L238">                .padding(32.dp),</span>
<span class="nc" id="L239">            horizontalAlignment = Alignment.CenterHorizontally,</span>
<span class="nc" id="L240">            verticalArrangement = Arrangement.Center</span>
        ) {
<span class="nc" id="L242">            Icon(</span>
<span class="nc" id="L243">                Icons.Default.Feedback,</span>
<span class="nc" id="L244">                contentDescription = null,</span>
<span class="nc" id="L245">                modifier = Modifier.size(64.dp),</span>
<span class="nc" id="L246">                tint = MaterialTheme.colorScheme.onSurfaceVariant</span>
            )
<span class="nc" id="L248">            Spacer(modifier = Modifier.height(16.dp))</span>
<span class="nc" id="L249">            Text(</span>
<span class="nc" id="L250">                text = &quot;No feedback submitted yet&quot;,</span>
<span class="nc" id="L251">                fontSize = 16.sp,</span>
<span class="nc" id="L252">                color = MaterialTheme.colorScheme.onSurfaceVariant</span>
            )
<span class="nc" id="L254">        }</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">    } else {</span>
<span class="nc" id="L256">        LazyColumn(</span>
<span class="nc" id="L257">            modifier = Modifier.fillMaxSize(),</span>
<span class="nc" id="L258">            contentPadding = PaddingValues(16.dp),</span>
<span class="nc" id="L259">            verticalArrangement = Arrangement.spacedBy(12.dp)</span>
<span class="nc" id="L260">        ) {</span>
<span class="nc" id="L261">            items(feedback) { item -&gt;</span>
                FeedbackItemCard(feedback = item)
            }
<span class="nc" id="L264">        }</span>
    }
<span class="nc bnc" id="L266" title="All 2 branches missed.">}</span>

@Composable
<span class="nc bnc" id="L269" title="All 10 branches missed.">fun FeedbackItemCard(feedback: FeedbackSubmission) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">    Card(</span>
<span class="nc" id="L271">        modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L272">        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)</span>
<span class="nc" id="L273">    ) {</span>
<span class="nc bnc" id="L274" title="All 6 branches missed.">        Column(</span>
<span class="nc" id="L275">            modifier = Modifier.padding(16.dp)</span>
        ) {
<span class="nc" id="L277">            Row(</span>
<span class="nc" id="L278">                modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L279">                horizontalArrangement = Arrangement.SpaceBetween,</span>
<span class="nc" id="L280">                verticalAlignment = Alignment.CenterVertically</span>
            ) {
<span class="nc" id="L282">                Text(</span>
<span class="nc" id="L283">                    text = feedback.feedbackType.name.replace(&quot;_&quot;, &quot; &quot;),</span>
<span class="nc" id="L284">                    fontSize = 14.sp,</span>
<span class="nc" id="L285">                    fontWeight = FontWeight.Bold,</span>
<span class="nc" id="L286">                    color = MaterialTheme.colorScheme.primary</span>
                )
<span class="nc" id="L288">                Text(</span>
<span class="nc" id="L289">                    text = feedback.status.name.replace(&quot;_&quot;, &quot; &quot;),</span>
<span class="nc" id="L290">                    fontSize = 12.sp,</span>
<span class="nc bnc" id="L291" title="All 5 branches missed.">                    color = when (feedback.status) {</span>
<span class="nc" id="L292">                        FeedbackStatus.RECEIVED -&gt; MaterialTheme.colorScheme.primary</span>
<span class="nc" id="L293">                        FeedbackStatus.REVIEWED -&gt; MaterialTheme.colorScheme.secondary</span>
<span class="nc" id="L294">                        FeedbackStatus.IMPLEMENTED -&gt; MaterialTheme.colorScheme.tertiary</span>
<span class="nc" id="L295">                        FeedbackStatus.DECLINED -&gt; MaterialTheme.colorScheme.error</span>
                    }
                )
<span class="nc" id="L298">            }</span>
            
<span class="nc" id="L300">            Spacer(modifier = Modifier.height(8.dp))</span>
            
<span class="nc" id="L302">            Text(</span>
<span class="nc" id="L303">                text = feedback.message,</span>
<span class="nc" id="L304">                fontSize = 14.sp</span>
            )
            
<span class="nc bnc" id="L307" title="All 2 branches missed.">            if (feedback.rating != null) {</span>
<span class="nc" id="L308">                Spacer(modifier = Modifier.height(8.dp))</span>
<span class="nc" id="L309">                Row(verticalAlignment = Alignment.CenterVertically) {</span>
<span class="nc" id="L310">                    Text(&quot;Rating: &quot;, fontSize = 12.sp)</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                    repeat(feedback.rating) {</span>
<span class="nc" id="L312">                        Icon(</span>
<span class="nc" id="L313">                            Icons.Default.Star,</span>
<span class="nc" id="L314">                            contentDescription = null,</span>
<span class="nc" id="L315">                            modifier = Modifier.size(16.dp),</span>
<span class="nc" id="L316">                            tint = MaterialTheme.colorScheme.primary</span>
                        )
<span class="nc" id="L318">                    }</span>
<span class="nc" id="L319">                }</span>
            }
            
<span class="nc bnc" id="L322" title="All 2 branches missed.">            if (feedback.category != null) {</span>
<span class="nc" id="L323">                Spacer(modifier = Modifier.height(4.dp))</span>
<span class="nc" id="L324">                Text(</span>
<span class="nc" id="L325">                    text = &quot;Category: ${feedback.category}&quot;,</span>
<span class="nc" id="L326">                    fontSize = 12.sp,</span>
<span class="nc" id="L327">                    color = MaterialTheme.colorScheme.onSurfaceVariant</span>
                )
            }
            
<span class="nc" id="L331">            Spacer(modifier = Modifier.height(8.dp))</span>
            
<span class="nc" id="L333">            Text(</span>
<span class="nc" id="L334">                text = SimpleDateFormat(&quot;MMM dd, yyyy HH:mm&quot;, Locale.getDefault())</span>
<span class="nc" id="L335">                    .format(feedback.submittedAt),</span>
<span class="nc" id="L336">                fontSize = 12.sp,</span>
<span class="nc" id="L337">                color = MaterialTheme.colorScheme.onSurfaceVariant</span>
            )
<span class="nc" id="L339">        }</span>
<span class="nc" id="L340">    }</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">}</span>

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>